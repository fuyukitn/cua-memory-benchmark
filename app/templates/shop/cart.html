<!DOCTYPE html>
<html><head>
  <meta charset="UTF-8">
  <title>Your Cart</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-4">
  <a href="{{ url_for('shop.index') }}" class="btn btn-secondary mb-3" data-event="back-to-store">‚Üê Back to Store</a>
  <h2>Your Cart</h2>
  <form method="post" action="{{ url_for('shop.update_cart') }}">
    <table class="table">
      <thead><tr><th>Product</th><th>Price</th><th>Quantity</th><th>Subtotal</th></tr></thead>
      <tbody>
        {% for p in products %}
        <tr>
          <td>{{ p.name }}</td>
          <td>${{ p.price }}</td>
          <td><input type="number" name="{{ p.id }}" value="{{ p.quantity }}" min="0" class="form-control w-50" /></td>
          <td>${{ p.subtotal }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% if international_shipping %}
    <p>International Shipping: $100.00</p>
    {% endif %}
    <h4>Total: ${{ total }}</h4>
    <button type="submit" class="btn btn-success" data-event="update-cart">Update Cart</button>
  </form>
</div>
</body>
<script>
  document.addEventListener("click", (e) => {
    const el = e.target.closest("a, button");
    if (!el) return;

    const payload = {
      event: el.dataset.event || "click",
      target: el.id || el.className || el.tagName,
      path: window.location.pathname,
      timestamp: Date.now()
    };

    fetch("/shop/api/logs", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
  });
</script>
</html>